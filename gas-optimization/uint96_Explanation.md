# uint96 ä½¿ç”¨è¯´æ˜ä¸ Remix æµ‹è¯•æŠ€å·§

## â“ ä¸ºä»€ä¹ˆä¼˜åŒ–ç‰ˆæœ¬ä½¿ç”¨ uint96ï¼Ÿ

### æ•°å€¼èŒƒå›´å¯¹æ¯”

```
uint256 æœ€å¤§å€¼ = 2^256 - 1 â‰ˆ 1.16 Ã— 10^77
uint96  æœ€å¤§å€¼ = 2^96  - 1 â‰ˆ 7.92 Ã— 10^28

1 ETH = 1,000,000,000,000,000,000 wei = 10^18 wei

ç»“è®ºï¼š
- uint96 å¯ä»¥å­˜å‚¨ 79,228,162,514 ETH (çº¦ 792 äº¿ ETH)
- ä»¥å¤ªåŠæ€»ä¾›åº”é‡çº¦ 120,000,000 ETH (1.2 äº¿ ETH)
- uint96 å®Œå…¨å¤Ÿç”¨ï¼
```

### ä¸ºä»€ä¹ˆä¸ç”¨ uint256ï¼Ÿ

**Gas ä¼˜åŒ–çš„æ ¸å¿ƒï¼šä½å‹ç¼©ï¼ˆBit Packingï¼‰**

```solidity
// âŒ æœªä¼˜åŒ–ï¼šä½¿ç”¨ uint256
struct Listing {
    address seller;      // 20 bytes - slot 0
    uint256 price;       // 32 bytes - slot 1  â† æµªè´¹ï¼
    bool isActive;       // 1 byte   - slot 2  â† æµªè´¹ï¼
    uint256 timestamp;   // 32 bytes - slot 3
}
// æ€»å…±ï¼š4 ä¸ª storage slots

// âœ… ä¼˜åŒ–ï¼šä½¿ç”¨ uint96
struct Listing {
    address seller;      // 20 bytes - slot 0
    uint96 price;        // 12 bytes - slot 0 â† æ‰“åŒ…ï¼
    bool isActive;       // 1 byte   - slot 1
    uint32 timestamp;    // 4 bytes  - slot 1 â† æ‰“åŒ…ï¼
}
// æ€»å…±ï¼š2 ä¸ª storage slots (èŠ‚çœ 50%!)
```

**Gas èŠ‚çœè®¡ç®—ï¼š**
- è¯»å– 4 ä¸ª slots: 2,100 + 3Ã—100 = 2,400 gas
- è¯»å– 2 ä¸ª slots: 2,100 + 100 = 2,200 gas
- **æ¯æ¬¡è¯»å–èŠ‚çœï¼š200 gas (8.3%)**

---

## ğŸ§ª Remix æµ‹è¯•æŠ€å·§

### é—®é¢˜ï¼šRemix è¾“å…¥æ¡†é™åˆ¶ï¼Ÿ

æœ‰æ—¶å€™ Remix çš„è¾“å…¥æ¡†å¯èƒ½æ˜¾ç¤ºä¸å…¨æˆ–è€…çœ‹èµ·æ¥æœ‰é™åˆ¶ï¼Œä½†å®é™…ä¸Š `uint96` å¯ä»¥å­˜å‚¨è¿™äº›å€¼ã€‚

### è§£å†³æ–¹æ¡ˆ 1: ä½¿ç”¨è¾ƒå°çš„æµ‹è¯•å€¼ï¼ˆæ¨èï¼‰â­

```
æ¨èæµ‹è¯•å€¼ï¼ˆæŒ‰å¤§å°æ’åºï¼‰ï¼š

0.001 ETH = 1000000000000000      (15 ä½æ•°å­—)
0.01 ETH  = 10000000000000000     (16 ä½æ•°å­—)
0.1 ETH   = 100000000000000000    (17 ä½æ•°å­—) â† æ¨è
1 ETH     = 1000000000000000000   (18 ä½æ•°å­—)
```

**ä¸ºä»€ä¹ˆæ¨è 0.1 ETHï¼Ÿ**
- âœ… æ•°å­—é•¿åº¦é€‚ä¸­ï¼Œå®¹æ˜“è¾“å…¥
- âœ… è¶³å¤Ÿå¤§ï¼Œèƒ½ä½“ç°ä»·æ ¼å·®å¼‚
- âœ… è®¡ç®—æ‰‹ç»­è´¹æ—¶ä¸ä¼šå¤ªå°ï¼ˆ2.5% = 0.0025 ETHï¼‰
- âœ… åœ¨ Remix ä¸­æ˜¾ç¤ºæ¸…æ™°

### è§£å†³æ–¹æ¡ˆ 2: ä½¿ç”¨ Remix çš„å•ä½è½¬æ¢

Remix çš„ VALUE è¾“å…¥æ¡†æ”¯æŒå•ä½ï¼Œä½†å‡½æ•°å‚æ•°æ¡†ä¸æ”¯æŒã€‚åªèƒ½æ‰‹åŠ¨è¾“å…¥ weiï¼š

```
åœ¨å‡½æ•°å‚æ•°ä¸­ï¼š
âŒ ä¸èƒ½è¾“å…¥ï¼š0.1 ether
âœ… å¿…é¡»è¾“å…¥ï¼š100000000000000000 (wei)
```

### è§£å†³æ–¹æ¡ˆ 3: ä½¿ç”¨ç§‘å­¦è®¡æ•°æ³•ï¼ˆéƒ¨åˆ†æµè§ˆå™¨æ”¯æŒï¼‰

æœ‰äº›æµè§ˆå™¨/Remix ç‰ˆæœ¬æ”¯æŒï¼š
```
1e17  = 100000000000000000 (0.1 ETH)
1e18  = 1000000000000000000 (1 ETH)
```

---

## ğŸ“ å®é™…æµ‹è¯•ç¤ºä¾‹

### åœºæ™¯ 1: listItem æµ‹è¯•

**æœªä¼˜åŒ–ç‰ˆæœ¬**ï¼ˆuint256ï¼‰ï¼š
```
tokenId: 1
price: 100000000000000000
```

**ä¼˜åŒ–ç‰ˆæœ¬**ï¼ˆuint96ï¼‰ï¼š
```
tokenId: 1
price: 100000000000000000  // å®Œå…¨ä¸€æ ·ï¼
```

### åœºæ™¯ 2: buyItem æµ‹è¯•

**æ­¥éª¤ï¼š**
1. å…ˆæ‰§è¡Œ `listItem`ï¼Œprice = `100000000000000000`
2. åˆ‡æ¢åˆ° Account 2
3. åœ¨ `buyItem` çš„ VALUE æ¡†è¾“å…¥ï¼š`0.1` é€‰æ‹©å•ä½ `ether`
4. `listingId`: `0`
5. ç‚¹å‡» transact

**è´¹ç”¨è®¡ç®—ï¼š**
```
ä»·æ ¼: 0.1 ETH
æ‰‹ç»­è´¹ (2.5%): 0.0025 ETH
å–å®¶æ”¶åˆ°: 0.0975 ETH
```

### åœºæ™¯ 3: æ‰¹é‡æ“ä½œæµ‹è¯•

```
å¯¹äº 10 ä¸ªå•†å“ï¼Œæ¯ä¸ª 0.01 ETHï¼š

tokenIds: [1,2,3,4,5,6,7,8,9,10]
prices: [10000000000000000,10000000000000000,10000000000000000,10000000000000000,10000000000000000,10000000000000000,10000000000000000,10000000000000000,10000000000000000,10000000000000000]

æç¤ºï¼šå¯ä»¥åœ¨æµè§ˆå™¨æ§åˆ¶å°ç”Ÿæˆï¼š
Array(10).fill("10000000000000000").join(",")
```

---

## ğŸ¯ å¿«é€Ÿå‚è€ƒè¡¨

### å¸¸ç”¨æµ‹è¯•é‡‘é¢

| é‡‘é¢ | Wei å€¼ | ä½æ•° | æ¨èåº¦ |
|------|--------|------|--------|
| 0.001 ETH | 1000000000000000 | 15 | â­ |
| 0.01 ETH | 10000000000000000 | 16 | â­â­ |
| 0.1 ETH | 100000000000000000 | 17 | â­â­â­ |
| 1 ETH | 1000000000000000000 | 18 | â­â­ |
| 10 ETH | 10000000000000000000 | 19 | â­ |

### uint ç±»å‹å¯¹æ¯”

| ç±»å‹ | å­—èŠ‚æ•° | æœ€å¤§å€¼ï¼ˆçº¦ï¼‰ | é€‚ç”¨åœºæ™¯ |
|------|--------|--------------|----------|
| uint8 | 1 | 255 | è®¡æ•°å™¨ã€çŠ¶æ€ç  |
| uint32 | 4 | 42 äº¿ | æ—¶é—´æˆ³ï¼ˆåˆ° 2106 å¹´ï¼‰ |
| uint96 | 12 | 7.9Ã—10^28 | ETH ä»·æ ¼ã€ä½™é¢ |
| uint128 | 16 | 3.4Ã—10^38 | å¤§é¢ä»£å¸ |
| uint256 | 32 | 1.2Ã—10^77 | é»˜è®¤é€‰æ‹© |

---

## ğŸ’¡ ä½å‹ç¼©ç­–ç•¥

### é€‰æ‹©åˆé€‚çš„ç±»å‹å¤§å°

```solidity
// ç¤ºä¾‹ï¼šNFT å…ƒæ•°æ®å­˜å‚¨

âŒ æµªè´¹ç©ºé—´ï¼š
struct NFT {
    uint256 tokenId;      // 32 bytes - slot 0
    uint256 price;        // 32 bytes - slot 1
    uint256 timestamp;    // 32 bytes - slot 2
    address owner;        // 20 bytes - slot 3
    bool forSale;         // 1 byte   - slot 4
}
// 5 ä¸ª slots!

âœ… ä¼˜åŒ–åï¼š
struct NFT {
    address owner;        // 20 bytes - slot 0
    uint96 price;         // 12 bytes - slot 0 (æ‰“åŒ…)
    uint32 tokenId;       // 4 bytes  - slot 1
    uint32 timestamp;     // 4 bytes  - slot 1 (æ‰“åŒ…)
    bool forSale;         // 1 byte   - slot 1 (æ‰“åŒ…)
}
// 2 ä¸ª slots! (èŠ‚çœ 60%)
```

### æ‰“åŒ…è§„åˆ™

1. **ä¸€ä¸ª slot = 32 bytes (256 bits)**
2. **å˜é‡æŒ‰é¡ºåºæ’åˆ—ï¼Œèƒ½æ”¾ä¸€èµ·å°±æ”¾ä¸€èµ·**
3. **ä¼˜å…ˆæŠŠå°ç±»å‹æ”¾ä¸€èµ·**

```
Slot ç¤ºæ„å›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ address (20) + uint96 (12) = 32 âœ…  â”‚ Slot 0
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ uint32 (4) + uint32 (4) + bool (1)  â”‚ Slot 1
â”‚ = 9 bytes (è¿˜å‰© 23 bytes å¯ç”¨)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æº¢å‡ºé£é™©

è™½ç„¶ uint96 å¯¹äº ETH ä»·æ ¼å¤Ÿç”¨ï¼Œä½†è¦æ³¨æ„è®¡ç®—ï¼š

```solidity
// âš ï¸ æ½œåœ¨é£é™©ï¼šä¹˜æ³•æº¢å‡º
uint96 price = 79000000000000000000000000000; // æ¥è¿‘æœ€å¤§å€¼
uint256 result = price * 2; // âœ… å®‰å…¨ï¼ˆè‡ªåŠ¨æå‡ä¸º uint256ï¼‰

// âŒ å±é™©ï¼š
uint96 result = price * 2; // å¯èƒ½æº¢å‡ºï¼
```

### 2. Solidity 0.8+ è‡ªåŠ¨æº¢å‡ºæ£€æŸ¥

```solidity
// Solidity 0.8+ é»˜è®¤ä¼šæ£€æŸ¥æº¢å‡º
uint96 a = type(uint96).max;
uint96 b = a + 1; // âŒ ä¼š revert

// å¦‚æœç¡®å®šä¸ä¼šæº¢å‡ºï¼Œå¯ä»¥ä½¿ç”¨ unchecked èŠ‚çœ gas
unchecked {
    uint96 b = a + 1; // âš ï¸ æº¢å‡ºä½†ä¸ä¼š revert
}
```

### 3. ç±»å‹è½¬æ¢

```solidity
uint256 bigValue = 1000000000000000000;
uint96 smallValue = uint96(bigValue); // âœ… æ˜¾å¼è½¬æ¢

// âš ï¸ å¦‚æœ bigValue > uint96 æœ€å¤§å€¼ï¼Œä¼šè¢«æˆªæ–­
```

---

## ğŸ“ å­¦ä¹ æ€»ç»“

### ä¸ºä»€ä¹ˆè¿™ä¸ªä¼˜åŒ–é‡è¦ï¼Ÿ

1. **Gas èŠ‚çœ**ï¼šä½å‹ç¼©æ˜¯æœ€æœ‰æ•ˆçš„ä¼˜åŒ–ä¹‹ä¸€
2. **å®ç”¨æ€§**ï¼šå‡ ä¹æ‰€æœ‰ DeFi é¡¹ç›®éƒ½ä½¿ç”¨
3. **æ€ç»´æ–¹å¼**ï¼šå­¦ä¼šæƒè¡¡ç²¾åº¦å’Œæˆæœ¬

### å®é™…é¡¹ç›®ä¸­çš„åº”ç”¨

**Uniswap V3**ï¼š
```solidity
struct Position {
    uint128 liquidity;      // 16 bytes
    uint256 feeGrowth0;     // 32 bytes
    uint256 feeGrowth1;     // 32 bytes
    uint128 tokensOwed0;    // 16 bytes - å’Œ liquidity æ‰“åŒ…
    uint128 tokensOwed1;    // 16 bytes
}
```

**OpenSea (Seaport)**ï¼š
```solidity
struct OrderParameters {
    address offerer;           // 20 bytes
    uint80 startTime;          // 10 bytes - æ‰“åŒ…
    uint80 endTime;            // 10 bytes
    // ...
}
```

---

## ğŸ“š å»¶ä¼¸é˜…è¯»

1. **EVM Storage Layout**: https://docs.soliditylang.org/en/latest/internals/layout_in_storage.html
2. **Gas Optimization**: https://github.com/wolflo/evm-opcodes/blob/main/gas.md
3. **Solidity 0.8 Changes**: https://docs.soliditylang.org/en/v0.8.0/080-breaking-changes.html

---

## âœ… å¿«é€Ÿæ£€æŸ¥æ¸…å•

åœ¨ä½¿ç”¨ uint96 ä¹‹å‰ï¼Œç¡®è®¤ï¼š

- [ ] æœ€å¤§å€¼è¶³å¤Ÿå¤§ï¼ˆå¯¹äº ETH ä»·æ ¼ï¼Œuint96 å¤Ÿç”¨ï¼‰
- [ ] ä¸å…¶ä»–å˜é‡æ‰“åŒ…èƒ½èŠ‚çœ gasï¼ˆé…åˆ addressã€uint32 ç­‰ï¼‰
- [ ] ä¸ä¼šåœ¨è®¡ç®—ä¸­æº¢å‡ºï¼ˆæ³¨æ„ä¹˜æ³•ï¼‰
- [ ] å›¢é˜Ÿç†è§£ä¸ºä»€ä¹ˆä½¿ç”¨éæ ‡å‡†å¤§å°

---

**è®°ä½**ï¼šGas ä¼˜åŒ–æ˜¯æƒè¡¡çš„è‰ºæœ¯ï¼Œä¸æ˜¯ç›²ç›®è¿½æ±‚æè‡´ã€‚uint96 å¯¹äºä»·æ ¼å­˜å‚¨æ˜¯å®Œç¾çš„é€‰æ‹©ï¼

---

**æœ€åæ›´æ–°**: 2026-01-21
**ç›¸å…³æ–‡ä»¶**: `GasOptimizationCase_After.sol`, `Remix_Test_Guide.md`
